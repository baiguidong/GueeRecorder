# GueeRecorder 前言
　　这是一个为了学习Linux下的应用程序开发，而编写的一个实验性的对屏幕和摄像头录像，然后保存为视频文件或直播到网络的软件。</br>
　　这是我第一次在Linux上开发的软件，在此之前我从未实践过Linux下的软件开发，甚至于在购买基于“龙芯3A4000”CPU的电脑之前，我对Linux系统的累计使用时间也没超过24小时。</br>
　　2020春节期间，在快递把龙芯3A4000送到之后，尝试编译了一款名为“SimpleScreenRecorder”的软件，但我对它的功能和性能都有些不满，于是就萌生了开发一款录屏软件的想法，虽然我知道同类软件中有个大名鼎鼎有OBS，但自己造个轮子我会用得更加开心。当然我也知道自己在Linux上的开发经验为0，可是仍然充满信心——反正也没人催我的进度，只要把预计的功能完成，并且运行效率稍高于SimpleScreenRecorder那就是胜利。然后一边学一边做大约花了半个月时间完成了一些基础的功能，只是由于众所周知的原因，不久后孩子开始上网课，公司也要求远程工作，于是每天疲于奔命，就中断了开发工作。后来虽然稍有了一些空闲时间，但每天琐事仍然很多，自造轮子这种不太紧要的事情也就一直没有重新拾起。中断之后，龙芯的电脑我都有半年没有开过机。</br>
　　本来很怀疑这个软件又会像我以往的众多半成品一样，一旦开发中断，就会躺在硬盘里再也见不到天日。但是出于对龙芯CPU的热爱，以及为了熟悉Linux下应用软件开发等原因，近期我决定把这个程序继续写完。并且打算在把它完成之后，再重写所有的代码，进一步提高软件的性能，重新设计软件界面，写出令我自己基本满意的作品。</br>

# 功能说明
　　可以录制屏幕、摄像头，还可加入图片和文本，并把这些内容使用OpenGL合成在同一个画面上编码为视频文件。软件有一个预览区域，在预览区域可以拖动各个图像的大小和位置。当选中某个图像时，会在预览区域中显示图层列表，可以通过功能按钮调整图层顺序及其它参数，或选中其它图层。可设置视频编码的参数，视频可保存为mp4或flv文件，也可直接向rtmp服务器推送直播视频流</br>
### 屏幕录像：
　　录制全屏，支持单屏和多屏幕；</br>
　　录制窗口，支持选择整个窗口或窗口客户区（不含窗口标题栏和边框）；</br>
　　录制区域，选择区域和选择窗口的操作与QQ截图类似。</br>
### 摄像头：
　　支持USB摄像头，可选择分辨率和帧率。</br>
### 图片文件：
　　支持 bmp、png、jpg 等常见格式。</br>
### 文字：
　　尚未完成。</br>
### 视频编码：
　　尚未完成。</br>

# 开发环境
### 硬件环境：
　　CPU：龙芯 Loongson 3A4000@1.8GHz</br>
　　内存：紫光 DDR4 2666 8G</br>
　　显卡：AMD R5 230</br>
　　硬盘：WD SN750 1T Nvme</br>
### 软件环境：
　　OS：统信 UOS 专业版、龙梦 Fedora28</br>
　　开发工具：Qt 5.x</br>
　　#### 开发环境配置：
　　因为我对Linux还不熟悉，因此避免了自行编译 Qt 和需要的第三方库，而是直接使用各个操作系统软件源中可下载安装的版本。
　　统信 UOS 专业版：
　　　　sudo apt-get install g++ gdb
　　　　sudo apt-get install libgl1-mesa-dev
　　　　sudo apt-get install libqt5x11extras5-dev
　　　　sudo apt-get install libxinerama-dev
　　　　sudo apt-get install libx264-dev
　　　　sudo apt-get install qt5-default
　　　　sudo apt-get install qt5creator

　　龙梦 Fedora28：
　　　　sudo dnf inatall g++ gdb
　　　　sudo dnf inatall qt5-devel
　　　　sudo dnf inatall qt-creator




# 日志：

2020-02-01 左右</br>
　　项目开始。初始开发环境：龙芯3A4000 + 龙梦Fedora28 + Qt5.x。</br>
　　我把龙芯3A4000电脑原配的AMD R5 230显卡更换成了AMD RX580，龙芯官方的loongnix系统暂时不能驱动它。相对来说龙梦Fedora28对个人用户更友好，虽然对各种办公设备的驱动可能不如loongnix完善，但对个人电脑常见的硬件能够支持得更好一些。

2020-02-10 左右</br>
　　开始陪伴孩子上网课，自由时间锐减。</br>
　　基本完成主界面搭建、选择截图区域的界面、屏幕截图、帧率控制、图像合成和预览、基本的图层管理等。</br>
　　这段时间的开发，Qt的跨平台特性作用很大。另外就是学习了x11的一些API，完成了屏幕载取相关功能。</br>
　　虽然使用的截图API与SimpleScreenRecorder这款软件使用的相同，但我对截图数据的缓存和使用方式和它不同，应该更有效率一些。</br>
　　x11截屏性能不高，可我对Linux还不熟，暂时没有找到其它的截屏相关的技术资料，打算以后读一读OBS的代码，看看它有没有什么不同。</br>

2020-02-15 左右</br>
　　公司复工，远程上班，加上孩子网课和作业，精力耗尽，开发中断。</br>
　　此时完成了在预览界面中编辑图层，以及对其它一些功能的完善。</br>
————————————————————————————</br>
开发中断6个月+</br>
————————————————————————————</br>
2020-08-22</br>
　　中断了半年的开发继续开始，决定晚上不上网刷帖灌水，尽量抽出时间完成这个软件。</br>
　　由于上次中断开发时，正在对一些功能进行调试，于是程序重新运行起来什么都不对。梳理了一遍代码，看懂了自己半年前写的东西，重新把已有的功能跑通。</br>

2020-08-23</br>
　　折腾操作系统，做乱七八糟的实验。反反复复轮流重新安装Fedora28和Loongnix。</br>

2020-08-25</br>
　　注册统信UOS开发者身份成功，下载统信UOS继续折腾操作系统，最后在硬盘上安装了3个操作系统，并配置了各自的开发环境。</br>
　　在x86笔记本Win10下，尝试在VMWare中安装UOS，然后把项目放入虚拟机，把现有功能调通。</br>

2020-08-27</br>
　　实验增加录制摄像头功能。并把较简单的对图像文件的支持加上。</br>
　　实验录音功能，由于对Linux了解太少，暂时没有头绪，Qt自带的录音类感觉效率有点低。</br>
　　实践证明在x86+Win10+VMWare+UOS的环境中，摄像头功能和录音功能都跑不通，决定不再尝试在虚拟机中开发。</br>

2020-08-29</br>
　　开发环境换回到真机，还是在龙芯3A4000上开发，只是操作系统从Fedora28换成了UOS，不是Fedora28不好，只是UOS更漂亮，顔值即正义。</br>
　　验证了Qt支持的数种获取摄像头数据的方法，决定还是取得YUYV原始数据，自己再处理为RGB，我认为这样会有更高的效率。</br>

2020-08-31</br>
　　把本项目上传到GitHub。</br>
　　对摄像头数据的处理，是把YUYV数据放入OpenGL纹理，在着色器中转换为RGB再用于渲染，不使用CPU计算。</br>
　　由于对Linux录音完全不了解，打算先把画面编码为h.264之后再增加录音功能。另外打算把合成的画面渲染到FBO时做一些处理，最好是从FBO取出就是I420的数据，可以直接送到x264编码器编码视频。</br>
